Function.prototype.bind = function(object) {
  var fn = this;
  return (function $boundMethod() {
    return arguments.length ? fn.apply(object,arguments) : fn.call(object); // call is faster at least in Firefox.
  });
};

(function(theGlobalObject){
  // define alias "js" for the top-level package, so that name-clashes in AS3 can be resolved:
  theGlobalObject.js = theGlobalObject;
  // defined here to avoid global name space pollution and unneccessary closures:
  function clone(object) {
    var empty = function(){ };
    empty.prototype =  object;
    return new empty();
  }
  function createGetQualified(create) {
    return (function(name) {
      var object = theGlobalObject;
      if (name) {
        var parts = name.split(".");
        for (var i=0; i<parts.length; ++i) {
          var subobject = object[parts[i]];
          try {
            if(String(subobject).indexOf("[JavaPackage")==0) {
              subobject =  null;
            }
          } catch(e) {
            subobject = null;
          }
          if (!subobject) {
            if (create) {
              subobject = object[parts[i]] = {};
            } else {
              return null;
            }
          }
          object = subobject;
        }
      }
      return object;
    });
  }

  theGlobalObject.joo = {
    getOrCreatePackage: createGetQualified(true),
    getQualifiedObject: createGetQualified(false),

    /*
    unsupported ActionScript features:
      - private non-static members
      - field initializers
      - typed catch clauses
      - dynamic class loading + resource bundles
      - all classes must reside within the joo package

     Caveat: static code blocks are executed immediately

     */
    classLoader: {
      prepare: function(packageDef, directives, classDef, memberFactory) {
        var classMatch = classDef.match(/^\s*((public|internal|final|dynamic)\s+)*class\s+([A-Za-z][a-zA-Z$_0-9]*)(\s+extends\s+([a-zA-Z$_0-9.]+))?(\s+implements\s+([a-zA-Z$_0-9.,\s]+))?\s*$/);
        var className = classMatch[3];
        var $extends = classMatch[5];
        var constructor;
        var publicConstructor = joo[className] = function() {
          constructor.apply(this, arguments);
        };
        var superConstructor;
        if ($extends) {
          superConstructor = joo.getQualifiedObject($extends);
          publicConstructor.prototype = clone(superConstructor.prototype);
        } else {
          superConstructor = Object;
          $extends = "Object";
        }
        publicConstructor.prototype[$extends] = superConstructor;
        var privateStatics = {$super: $extends};
        var members = memberFactory(privateStatics);
        var staticInitializer;
        for (var i = 0; i < members.length; ++i) {
          var memberDeclaration = members[i];
          switch (typeof memberDeclaration) {
            case "function": staticInitializer = memberDeclaration; break;
            case "string":
              var isStatic = memberDeclaration.match(/\bstatic\b/);
              var isPrivate = memberDeclaration.match(/\bprivate\b/);
              var target = isStatic ? isPrivate ? privateStatics : publicConstructor : publicConstructor.prototype;
              var member = members[++i];
              if (typeof member == "function") {
                var methodName = memberDeclaration.match(/function\s+([a-zA-Z$_0-9]+)/)[1];
                if (methodName == className) {
                  constructor = member;
                } else {
                  target[methodName] = member;
                }
              } else {
                for (var m in member) {
                  target[m] = member[m];
                }
              }
          }
        }
        if (staticInitializer) {
          staticInitializer();
        }
      },
      init: function() {
        // ignore
      }
    }
  };
})(this);
joo.window = window;
// function assert(cond : Object, file : String, line : uint, column : uint) : void
joo.assert = function joo$assert(cond, file, line, column) {
  if (!cond)
    throw new Error(file+"("+line+":"+column+"): assertion failed");
};
// simulate ActionScript's Class object for type casts and "is"
Class = function joo$Class(c){return c;};
Class.$class = {
  isInstance: function(f){return typeof f=="function";}
};
// function trace(msg : String) : void
joo.trace = function joo$trace(msg) {
  msg = "AS3: " + msg;
  var console;
  if ((console = joo.getQualifiedObject("console")) && console.log) {
    console.log(msg);
  } else if ((console = joo.getQualifiedObject("runtime")) && console.trace) {
    console.trace(msg);
  } else if (console = joo.getQualifiedObject("trace")) {
    console(msg);
  } else if (console = joo.getQualifiedObject("opera")) {
    console.postError(msg);
  }
};
joo.classLoader.prepare("package joo",[""],"public class MemberDeclaration",function($$private){with($$private)return["public static const",{METHOD_TYPE_GET:"get",METHOD_TYPE_SET:"set",MEMBER_TYPE_VAR:"var",MEMBER_TYPE_CONST:"const",MEMBER_TYPE_FUNCTION:"function",NAMESPACE_PRIVATE:"private",NAMESPACE_INTERNAL:"internal",NAMESPACE_PROTECTED:"protected",NAMESPACE_PUBLIC:"public",STATIC:"static",FINAL:"final",NATIVE:"native",BOUND:"bound",OVERRIDE:"override"},"private static var",{SUPPORTS_GETTERS_SETTERS: undefined},"private static var",{DEFINE_METHOD: undefined},"private static var",{LOOKUP_METHOD: undefined},function(){$$private.SUPPORTS_GETTERS_SETTERS="__defineGetter__"in Object['prototype'];$$private.DEFINE_METHOD={"get":"__defineGetter__","set":"__defineSetter__"};$$private.LOOKUP_METHOD={"get":"__lookupGetter__","set":"__lookupSetter__"};},"public static function create",function(memberDeclarationStr){var tokens=memberDeclarationStr.split(/\s+/);return tokens[0]=="import"?null:new joo.MemberDeclaration(tokens);},"internal var",{_namespace:"internal",_static:false,_final:false,_native:false,_bound:false,_override:false,_cloneFactory: undefined},"public var",{memberType: undefined,getterOrSetter: undefined,memberName: undefined,slot: undefined,value: undefined},"public function MemberDeclaration",function(tokens){this[$super]();for(var j=0;j<tokens.length;++j){var token=tokens[j];if(!this.memberType){switch(token){case joo.MemberDeclaration.STATIC:case joo.MemberDeclaration.FINAL:case joo.MemberDeclaration.NATIVE:case joo.MemberDeclaration.BOUND:case joo.MemberDeclaration.OVERRIDE:this["_"+token]=true;break;case joo.MemberDeclaration.MEMBER_TYPE_VAR:case joo.MemberDeclaration.MEMBER_TYPE_CONST:case joo.MemberDeclaration.MEMBER_TYPE_FUNCTION:this.memberType=token;break;default:this._namespace=token;}}else{if(this.isMethod()&&$$private.LOOKUP_METHOD[this.memberName]){this.getterOrSetter=this.memberName;}this.memberName=token;}}if(!this.memberType){throw new Error("Missing member type in declaration '"+tokens.join(" ")+"'.");}},"public function getQualifiedName",function(){return this._namespace+"::"+this.memberName;},"public function isPrivate",function(){return this._namespace==joo.MemberDeclaration.NAMESPACE_PRIVATE;},"public function isStatic",function(){return this._static;},"public function isFinal",function(){return this._final;},"public function isNative",function(){return this._native;},"public function isOverride",function(){return this._override;},"public function isBound",function(){return this._bound;},"public function isMethod",function(){return this.memberType==joo.MemberDeclaration.MEMBER_TYPE_FUNCTION;},"public function getNativeMember",function(publicConstructor){var target=this.isStatic()?publicConstructor:publicConstructor.prototype;if(this.memberType==joo.MemberDeclaration.MEMBER_TYPE_FUNCTION&&this.getterOrSetter){this.memberType=joo.MemberDeclaration.MEMBER_TYPE_VAR;this.getterOrSetter=null;}try{var member=target[this.memberName];}catch(e){}if(typeof member!="function"){var memberObject={};memberObject[this.memberName]=member;member=memberObject;}return member;},"public function hasOwnMember",function(target){if(!this.getterOrSetter&&target.hasOwnProperty){return target.hasOwnProperty(this.slot);}var value=this.retrieveMember(target);if(value!==undefined&&target.constructor){var superTarget=target.constructor.prototype;var superValue=this.retrieveMember(superTarget);if(value!==superValue){return true;}}return false;},"public function retrieveMember",function(target){if(!target){return undefined;}var slot=this.slot;if(this.getterOrSetter){if($$private.SUPPORTS_GETTERS_SETTERS){return target[$$private.LOOKUP_METHOD[this.getterOrSetter]](slot);}else{slot=this.getterOrSetter+"$"+slot;}}return target[slot];},"public function storeMember",function(target){if(!this.isNative()){var slot=this.slot;if(this.getterOrSetter){if($$private.SUPPORTS_GETTERS_SETTERS){var oppositeMethodType=this.getterOrSetter==joo.MemberDeclaration.METHOD_TYPE_GET?joo.MemberDeclaration.METHOD_TYPE_SET:joo.MemberDeclaration.METHOD_TYPE_GET;var counterpart=target[$$private.LOOKUP_METHOD[oppositeMethodType]](slot);if(counterpart&&counterpart===target.constructor.prototype[$$private.LOOKUP_METHOD[oppositeMethodType]](slot)){target[$$private.DEFINE_METHOD[oppositeMethodType]](slot,counterpart);}target[$$private.DEFINE_METHOD[this.getterOrSetter]](slot,this.value);return;}else{slot=this.getterOrSetter+"$"+slot;}}target[slot]=this.value;}},"public function hasInitializer",function(){return this.memberType!=joo.MemberDeclaration.MEMBER_TYPE_FUNCTION&&typeof this.value=="function"&&this.value.constructor!==RegExp;},"public function _getCloneFactory",function(){if(!this._cloneFactory){this._cloneFactory=function(){};this._cloneFactory.prototype=this;}return this._cloneFactory;},"public function clone",function(changedProperties){var CloneFactory=this._getCloneFactory();var clone=new CloneFactory();for(var m in changedProperties){clone[m]=changedProperties[m];}return clone;},"public function toString",function(){var sb=[this._namespace];if(this._static){sb.push(joo.MemberDeclaration.STATIC);}if(this._override){sb.push(joo.MemberDeclaration.OVERRIDE);}if(this._bound){sb.push(joo.MemberDeclaration.BOUND);}sb.push(this.memberType);if(this.getterOrSetter){sb.push(this.getterOrSetter);}sb.push(this.memberName);return sb.join(" ");},];},["create"],["Object","Error","RegExp"]);joo.classLoader.prepare("package joo",[""],"public class NativeClassDeclaration",function($$private){with($$private)return["internal static function createEmptyConstructor",function(constructor_){var emptyConstructor=function(){this.constructor=constructor_;};emptyConstructor.prototype=constructor_.prototype;return emptyConstructor;},"public var",{level:-1,fullClassName: undefined,constructor_: undefined,publicConstructor: undefined,completed:false,inited:false,Public: undefined,superClassDeclaration: undefined,interfaces: undefined},"public function NativeClassDeclaration",function(){this[$super]();},"public function create",function(fullClassName,publicConstructor){this.fullClassName=fullClassName;this.publicConstructor=publicConstructor;try{this.publicConstructor["$class"]=this;}catch(e){if(is(e,Error)){}else throw e;}return this;},"public function complete",function(){if(!this.completed){this.completed=true;this.doComplete();}return this;},"private static const",{ERROR_CONSTRUCTOR:function(message){this.message=message||"";}},"protected function doComplete",function(){this.interfaces=[];this.constructor_=this.publicConstructor===Error?$$private.ERROR_CONSTRUCTOR:this.publicConstructor;this.Public=joo.NativeClassDeclaration.createEmptyConstructor(this.publicConstructor);},"public function init",function(){if(!this.inited){this.inited=true;this.complete();this.doInit();}return this;},"protected function doInit",function(){},"public function isInstance",function(object){return object instanceof this.constructor_||object&&object.constructor===this.constructor_;},"public function getQualifiedName",function(){return this.fullClassName.replace(/\.([^\.]+)^/,"::");},"public function toString",function(){return this.fullClassName;},];},["createEmptyConstructor"],["Error"]);joo.classLoader.prepare("package joo",[""],"public class SystemClassDeclaration extends joo.NativeClassDeclaration",function($$private){with($$private)return[function(){joo.classLoader.init(joo.MemberDeclaration);},"protected static function createDefaultConstructor",function(superName){return(function $DefaultConstructor(){this[superName].apply(this,arguments);});},"protected static function createPublicConstructor",function(cd){return function joo$SystemClassDeclaration$constructor(){this.constructor=cd.publicConstructor;cd.constructor_.apply(this,arguments);};},"private static function is_",function(object,type){if(!type||object===undefined||object===null){return false;}if(object instanceof type||object.constructor===type){return true;}if(type["$class"]){return(type["$class"]).isInstance(object);}return false;},function(){joo.getQualifiedObject("joo")["is"]=$$private.is_;},"protected var",{package_: undefined,isInterface:false,namespace_:"intern",className: undefined,native_:false,extends_:"Object",privateStatics: undefined,memberDeclarations: undefined,memberDeclarationsByQualifiedName: undefined,initializerNames: undefined,staticInitializers: undefined,boundMethodNames: undefined,publicStaticMethodNames: undefined},"public function SystemClassDeclaration",function(packageDef,directives,classDef,memberDeclarations,publicStaticMethodNames){this[$super]();var packageName=packageDef.split(/\s+/)[1]||"";this.package_=joo.getOrCreatePackage(packageName);this.parseDirectives(packageName,directives);var classMatch=classDef.match(/^\s*((public|internal|final|dynamic)\s+)*class\s+([A-Za-z][a-zA-Z$_0-9]*)(\s+extends\s+([a-zA-Z$_0-9.]+))?(\s+implements\s+([a-zA-Z$_0-9.,\s]+))?\s*$/);var interfaces;if(classMatch){if(classMatch[5]){this.extends_=classMatch[5];}interfaces=classMatch[7];}else{classMatch=classDef.match(/^\s*((public|internal)\s+)?interface\s+([A-Za-z][a-zA-Z$_0-9]*)(\s+extends\s+([a-zA-Z$_0-9.,\s]+))?\s*$/);this.isInterface=true;interfaces=classMatch[5];}if(!classMatch){throw new Error("SyntaxError: \""+classDef+"\" does not match.");}this.namespace_=classMatch[2];this.className=classMatch[3];var fullClassName=this.className;if(packageName){fullClassName=packageName+"."+this.className;}this.interfaces=interfaces?interfaces.split(/\s*,\s*/):[];this.memberDeclarations=memberDeclarations;this.publicStaticMethodNames=publicStaticMethodNames;var publicConstructor=joo.getQualifiedObject(fullClassName);if(publicConstructor){this.native_=true;}else{publicConstructor=joo.SystemClassDeclaration.createPublicConstructor(this);this.package_[this.className]=publicConstructor;}this.create(fullClassName,publicConstructor);var jooPackage=joo.getQualifiedObject("joo");this.privateStatics={"assert":jooPackage.assert,"is":$$private.is_,"trace":jooPackage.trace};},"public function isNative",function(){return this.native_;},"protected function parseDirectives",function(packageName,directives){},"protected override function doComplete",function(){this.superClassDeclaration=joo.classLoader.getRequiredClassDeclaration(this.extends_);this.superClassDeclaration.complete();this.level=this.superClassDeclaration.level+1;this.privateStatics.$super="$"+this.level+"super";var Super=this.superClassDeclaration.Public;if(!this.native_){this.publicConstructor.prototype=new Super();this.publicConstructor["superclass"]=this.publicConstructor.prototype;}this.Public=joo.NativeClassDeclaration.createEmptyConstructor(this.publicConstructor);},"protected function initMembers",function(){this.initializerNames=[];this.staticInitializers=[];this.boundMethodNames=[];var memberDeclarations=this.memberDeclarations(this.privateStatics);this.memberDeclarations=[];this.memberDeclarationsByQualifiedName={};this.constructor_=null;for(var i=0;i<memberDeclarations.length;++i){var item=memberDeclarations[i];switch(typeof item){case"undefined":continue;case"function":this.staticInitializers.push(item);break;case"string":var memberDeclaration=joo.MemberDeclaration.create(item);if(memberDeclaration){if(!memberDeclaration.isNative()){if(++i>=memberDeclarations.length){throw new Error(this+": Member expected after modifiers '"+item+"'.");}var member=memberDeclarations[i];}if(memberDeclaration.memberType=="function"){this.initMethod(memberDeclaration,member);}else{for(var memberName in member){this._storeMember(this._createMemberDeclaration(memberDeclaration,{memberName:memberName}),member[memberName]);}}}}}var defaultConstructor=this.native_?this.publicConstructor:this.publicConstructor.prototype["$"+this.level+"super"]=this.initializerNames.length==0?this.superClassDeclaration.constructor_:$$private.createSuperCall(this);if(!this.constructor_){this.constructor_=defaultConstructor;}if(this.boundMethodNames.length>0){this.constructor_=$$private.createMethodBindingConstructor(this.constructor_,this.boundMethodNames);}},"private static function createSuperCall",function(cd){if(cd.extends_=="Object"){return function $super(){for(var i=0;i<cd.initializerNames.length;++i){var slot=cd.initializerNames[i];this[slot]=this[slot]();}};}return function $super(){cd.superClassDeclaration.constructor_.apply(this,arguments);for(var i=0;i<cd.initializerNames.length;++i){var slot=cd.initializerNames[i];this[slot]=this[slot]();}};},"private static function createMethodBindingConstructor",function(constructor_,boundMethodNames){return function $bindMethods(){for(var i=0;i<boundMethodNames.length;++i){var slot=boundMethodNames[i];this[slot]=this[slot].bind(this);}constructor_.apply(this,arguments);};},"protected function _initSlot",function(memberDeclaration){memberDeclaration.slot=memberDeclaration.isPrivate()&&!memberDeclaration.isStatic()?this.privateStatics["$"+memberDeclaration.memberName]="$"+this.level+memberDeclaration.memberName:memberDeclaration.memberName;},"protected function initMethod",function(memberDeclaration,member){if(memberDeclaration.memberName==this.className&&!memberDeclaration.isStatic()){if(memberDeclaration.getterOrSetter){throw new Error(this+": Class name cannot be used for getter or setter: "+memberDeclaration);}this.constructor_=memberDeclaration.isNative()?this.publicConstructor:member;}else{this._initSlot(memberDeclaration);if(memberDeclaration.isNative()){member=memberDeclaration.getNativeMember(this.publicConstructor);}if(this.extends_!="Object"){var superMethod=memberDeclaration.retrieveMember(this.superClassDeclaration.Public.prototype);}var overrides=! !superMethod&&superMethod!==member&&superMethod!==Object['prototype'][memberDeclaration.memberName];if(overrides!==memberDeclaration.isOverride()){var msg=overrides?"Method overrides without 'override' modifier":"Method with 'override' modifier does not override";throw new Error(this+": "+msg+": "+memberDeclaration);}if(overrides){this._storeMember(this._createMemberDeclaration(memberDeclaration,{_namespace:joo.MemberDeclaration.NAMESPACE_PRIVATE}),superMethod);}this._storeMember(memberDeclaration,member);if(memberDeclaration.isBound()){this.boundMethodNames.push(memberDeclaration.slot);}}},"protected function _createMemberDeclaration",function(memberDeclaration,changedProperties){var newMemberDeclaration=memberDeclaration.clone(changedProperties);this._initSlot(newMemberDeclaration);return newMemberDeclaration;},"protected function _storeMember",function(memberDeclaration,value){this.memberDeclarations.push(memberDeclaration);this.memberDeclarationsByQualifiedName[memberDeclaration.getQualifiedName()]=memberDeclaration;memberDeclaration.value=value;var _static=memberDeclaration.isStatic();var _private=memberDeclaration.isPrivate();var target=_static?_private?this.privateStatics:this.publicConstructor:this.publicConstructor.prototype;if(!target){target={};}if(!memberDeclaration.hasOwnMember(target)){memberDeclaration.storeMember(target);if(memberDeclaration.hasInitializer()){if(_static){this.staticInitializers.push(memberDeclaration);}else{this.initializerNames.push(memberDeclaration.slot);}}}},"protected override function doInit",function(){this.superClassDeclaration.init();this.initMembers();for(var i=0;i<this.staticInitializers.length;++i){var staticInitializer=this.staticInitializers[i];if(typeof staticInitializer=="function"){staticInitializer();}else{var target=staticInitializer.isPrivate()?this.privateStatics:this.publicConstructor;target[staticInitializer.slot]=target[staticInitializer.slot]();}}},"public function getMemberDeclaration",function(namespace_,memberName){return this.memberDeclarationsByQualifiedName[namespace_+"::"+memberName];},];},[],["joo.NativeClassDeclaration","Array","Error","joo.MemberDeclaration","Object"]);joo.classLoader.prepare("package joo",[""],"public class SystemClassLoader",function($$private){with($$private)return[function(){joo.classLoader=new joo.SystemClassLoader();},"public static const",{classDeclarationsByName:function(){return({});}},"public var",{debug:false},"public function SystemClassLoader",function(){this[$super]();},"public function prepare",function(packageDef,directives,classDef,memberFactory,publicStaticMethodNames,dependencies){var cd=this.createClassDeclaration(packageDef,directives,classDef,memberFactory,publicStaticMethodNames,dependencies);joo.SystemClassLoader.classDeclarationsByName[cd.fullClassName]=cd;},"protected function createClassDeclaration",function(packageDef,directives,classDef,memberFactory,publicStaticMethodNames,dependencies){return new joo.SystemClassDeclaration(packageDef,directives,classDef,memberFactory,publicStaticMethodNames).init();},"public function getClassDeclaration",function(fullClassName){var cd=joo.SystemClassLoader.classDeclarationsByName[fullClassName];if(!cd){var constructor_=joo.getQualifiedObject(fullClassName);if(constructor_){if(!constructor_["$class"]){cd=this.createNativeClassDeclaration(fullClassName,constructor_).init();joo.SystemClassLoader.classDeclarationsByName[fullClassName]=cd;}else{cd=constructor_["$class"];}}}return cd;},"public function getRequiredClassDeclaration",function(className){var cd=this.getClassDeclaration(className);if(!cd){throw new Error("Class not found: "+className);}return cd;},"protected function createNativeClassDeclaration",function(fullClassName,nativeClass){return new joo.NativeClassDeclaration().create(fullClassName,nativeClass);},"public function init",function(){var classes=arguments;return null;},];},[],["joo.SystemClassDeclaration","Error","joo.NativeClassDeclaration"]);joo.classLoader.prepare("package",[""],"public class Array extends Object",function($$private){with($$private)return["public static const",{CASEINSENSITIVE:1},"public static const",{DESCENDING:2},"public static const",{NUMERIC:16},"public static const",{RETURNINDEXEDARRAY:8},"public static const",{UNIQUESORT:4},"public native function get length","public native function set length","public native function Array","public native function concat","public function every",function(callback,thisObject){if(arguments.length<2){thisObject=null;}var i=0,j=this.length;if(thisObject){for(;i<j;i++){if(i in this){if(!callback.call(thisObject,this[i],i,this)){return false;}}}}else{for(;i<j;i++){if(i in this){if(!callback(this[i],i,this)){return false;}}}}return true;},"public function filter",function(callback,thisObject){var len=this.length;var res=[];var i=0;var val;if(thisObject){for(;i<len;i++){if(i in this){val=this[i];if(callback.call(thisObject,val,i,this)){res.push(val);}}}}else{for(;i<len;i++){if(i in this){val=this[i];if(callback(val,i,this)){res.push(val);}}}}return res;},"public function forEach",function(callback,thisObject){var i=0,j=this.length;if(thisObject){for(;i<j;i++){if(i in this){callback.call(thisObject,this[i],i,this);}}}else{for(;i<j;i++){if(i in this){callback(this[i],i,this);}}}},"public function indexOf",function(searchElement,fromIndex){if(arguments.length<2){fromIndex=0;}var len=this.length;for(var i=(fromIndex<0)?Math.max(0,len+fromIndex):fromIndex||0;i<len;i++){if(searchElement===this[i])return i;}return-1;},"public native function join","public function lastIndexOf",function(searchElement,fromIndex){if(arguments.length<2){fromIndex=0x7fffffff;}var len=this.length;for(var i=((fromIndex<0)?Math.max(len,len-fromIndex):fromIndex||len)-1;i>=0;i--){if(searchElement===this[i])return i;}return-1;},"public function map",function(callback,thisObject){if(arguments.length<2){thisObject=null;}var results=[];var i=0,j=this.length;if(thisObject){for(;i<j;i++){results[i]=callback.call(thisObject,this[i],i,this);}}else{for(;i<j;i++){results[i]=callback(this[i],i,this);}}return results;},"public native function pop","public native function push","public native function reverse","public native function shift","public native function slice","public function some",function(callback,thisObject){if(arguments.length<2){thisObject=null;}var i=0,j=this.length;if(thisObject){for(;i<j;i++){if(i in this){if(callback.call(thisObject,this[i],i,this)){return true;}}}}else{for(;i<j;i++){if(i in this){if(callback(this[i],i,this)){return true;}}}}return false;},"public native function sort","public native function splice","public native function toLocaleString","public native function toString","public native function unshift",];},[],["Object","Math"]);joo.classLoader.prepare("package joo",[""],"public class ImportMap",function($$private){with($$private)return["private var",{importsByName: undefined},"private var",{importedPackages: undefined},"public function ImportMap",function(){this[$super]();this[$importsByName]={};this[$importedPackages]=[""];},"public function addImport",function(fullClassName){var afterLastDotIndex=fullClassName.lastIndexOf(".")+1;var packageName=fullClassName.substring(0,afterLastDotIndex);var className=fullClassName.substring(afterLastDotIndex);if(className=="*"){this[$importedPackages].push(packageName);}else{if(className in this[$importsByName]&&this[$importsByName][className]!=fullClassName){delete this[$importsByName][className];}else{this[$importsByName][className]=fullClassName;}}},"public function getImports",function(){var imports=[];for(var $1 in this[$importsByName]){var im=this[$importsByName][$1];imports.push(im);}return imports;},"public function findQualifiedName",function(className){if(className.indexOf(".")<0){var fqn=this[$importsByName][className];if(fqn){return fqn;}var packages=this[$importedPackages];for(var i=packages.length-1;i>=0;--i){fqn=packages[i]+className;if(joo.classLoader.getClassDeclaration(fqn)){return fqn;}}}return className;},"public function addToMap",function(map){for(var im in this[$importsByName]){var classDeclaration=joo.classLoader.getClassDeclaration(this[$importsByName][im]);if(classDeclaration){map[im]=classDeclaration.publicConstructor;}}return map;},"public function init",function(){for(var im in this[$importsByName]){joo.classLoader.getRequiredClassDeclaration(this[$importsByName][im]).init();}},];},[],[]);joo.classLoader.prepare("package joo",[""],"public class ClassDeclaration extends joo.SystemClassDeclaration",function($$private){with($$private)return["private var",{importMap: undefined},"private var",{dependencies: undefined},"public function ClassDeclaration",function(packageDef,directives,classDef,memberDeclarations,publicStaticMethods,dependencies){this[$super](packageDef,directives,classDef,memberDeclarations,publicStaticMethods);this[$dependencies]=dependencies;},"public function getDependencies",function(){var dependencies=this[$dependencies]?this[$dependencies]:this[$importMap].getImports();dependencies=dependencies.concat([this[$importMap].findQualifiedName(this.extends_)]);return dependencies;},"override protected function parseDirectives",function(packageName,directives){this[$importMap]=new joo.ImportMap();this[$importMap].addImport(packageName+".*");directives.forEach(this[$parseDirective]);},"private bound function parseDirective",function(directive){var importMatch=directive.match(/^\s*import\s+(([a-zA-Z$_0-9]+\.)*(\*|[a-zA-Z$_0-9]+))\s*$/);if(importMatch){this[$importMap].addImport(importMatch[1]);}},"override protected function doComplete",function(){this.extends_=this[$importMap].findQualifiedName(this.extends_);this[$doComplete]();for(var i=0;i<this.interfaces.length;++i){this.interfaces[i]=this[$importMap].findQualifiedName(this.interfaces[i]);}this[$importMap].addToMap(this.privateStatics);$$private.createInitializingConstructor(this);this.publicStaticMethodNames.forEach(this[$createInitializingStaticMethod]);},"private static function createInitializingConstructor",function(classDeclaration){classDeclaration.constructor_=function(){classDeclaration.init();classDeclaration.constructor_.apply(this,arguments);};},"private bound function createInitializingStaticMethod",function(methodName){var classDeclaration=this;classDeclaration.publicConstructor[methodName]=function(){classDeclaration.init();return classDeclaration.publicConstructor[methodName].apply(null,arguments);};},"private bound function deleteInitializingStaticMethod",function(methodName){delete this.publicConstructor[methodName];},"protected override function doInit",function(){this.publicStaticMethodNames.forEach(this[$deleteInitializingStaticMethod]);this[$doInit]();this.interfaces.forEach(function(interface_,i,interfaces){interfaces[i]=joo.classLoader.getRequiredClassDeclaration(interface_);interfaces[i].init();});},"public override function isInstance",function(object){return typeof object=="object"&&object.constructor["$class"]?this.isAssignableFrom(object.constructor["$class"]):false;},"protected bound function isAssignableFrom",function(cd){do{if(this===cd){return true;}if(this.isInterface){if(cd.interfaces.some(this.isAssignableFrom)){return true;}}cd=cd.superClassDeclaration;}while(cd);return false;},];},[],["joo.SystemClassDeclaration","joo.ImportMap","Array"]);joo.classLoader.prepare("package joo",[""],"public class StandardClassLoader extends joo.SystemClassLoader",function($$private){with($$private)return["private static var",{classDeclarations:function(){return([]);}},"private var",{importMap: undefined},"public function StandardClassLoader",function(){this[$super]();this[$importMap]=new joo.ImportMap();},"override protected function createClassDeclaration",function(packageDef,directives,classDef,memberFactory,publicStaticMethodNames,dependencies){var cd=new joo.ClassDeclaration(packageDef,directives,classDef,memberFactory,publicStaticMethodNames,dependencies);$$private.classDeclarations.push(cd);return cd;},"public function loadScript",function(uri){var script=joo.window.document.createElement("script");script.type="text/javascript";joo.window.document.getElementsByTagName("HEAD")[0].appendChild(script);script.src=uri;return script;},"public function import_",function(fullClassName){this[$importMap].addImport(fullClassName);},"public function run",function(mainClassName){var args=Array.prototype.slice.call(arguments,1);this.complete(function(){var mainClass=this.getRequiredClassDeclaration(mainClassName);mainClass.publicConstructor["main"].apply(null,args);}.bind(this));},"public override function init",function(){var classes=arguments;var clazz;for(var i=0;i<classes.length;++i){if("$class"in classes[i]){((clazz=classes[i])["$class"]).init();}}return clazz;},"public function complete",function(onCompleteCallback){this.completeAll();if(onCompleteCallback){this.doCompleteCallbacks([onCompleteCallback]);}},"protected function completeAll",function(){$$private.classDeclarations.forEach(function(classDeclaration){classDeclaration.complete();if(classDeclaration.isNative()){classDeclaration.init();}});},"protected function doCompleteCallbacks",function(onCompleteCallbacks){if(onCompleteCallbacks.length){this[$importMap].init();var importMap=this[$importMap].addToMap({});for(var i=0;i<onCompleteCallbacks.length;++i){(onCompleteCallbacks[i])(importMap);}}},];},[],["joo.SystemClassLoader","joo.ImportMap","joo.ClassDeclaration"]);joo.classLoader.prepare("package joo",["import Error",""],"public class DynamicClassLoader extends joo.StandardClassLoader",function($$private){with($$private)return["public static const",{STANDARD_URL_PREFIX:"scripts/classes/"},"private static function isEmpty",function(object){for(var m in object){return false;}return true;},"public var",{urlPrefix: undefined},"private var",{onCompleteCallbacks:function(){return([]);}},"public function DynamicClassLoader",function(){this[$super]();joo.classLoader=this;},"private var",{pendingDependencies:function(){return([]);}},"private var",{pendingClassState:function(){return({});}},"override protected function createClassDeclaration",function(packageDef,directives,classDef,memberFactory,publicStaticMethodNames,dependencies){var cd=this[$createClassDeclaration](packageDef,directives,classDef,memberFactory,publicStaticMethodNames,dependencies);this[$pendingDependencies].push(cd);if(delete this[$pendingClassState][cd.fullClassName]){if(this.debug){trace("prepared class "+cd.fullClassName+", removed from pending classes.");}if(this[$onCompleteCallbacks].length){this[$loadPendingDependencies]();if($$private.isEmpty(this[$pendingClassState])){this.doCompleteCallbacks(this[$onCompleteCallbacks]);}}}return cd;},"override protected function doCompleteCallbacks",function(onCompleteCallbacks){this[$onCompleteCallbacks]=[];joo.window.setTimeout(function(){this.completeAll();this[$internalDoCompleteCallbacks](onCompleteCallbacks);}.bind(this),0);},"private function internalDoCompleteCallbacks",function(onCompleteCallbacks){this[$doCompleteCallbacks](onCompleteCallbacks);},"private function createClassLoadErrorHandler",function(fullClassName,url){return function(){this.classLoadErrorHandler(fullClassName,url);}.bind(this);},"public function classLoadErrorHandler",function(fullClassName,url){trace("Class "+fullClassName+" not found at URL ["+url+"].");},"public override function import_",function(fullClassName){this[$import_](fullClassName);this[$load](fullClassName);},"override public function run",function(mainClassName){var args=Array.prototype.slice.call(arguments,1);this[$load](mainClassName);args.splice(0,0,mainClassName);this[$run].apply(this,args);},"private function load",function(fullClassName){if(!this.getClassDeclaration(fullClassName)){if(joo.window.joo__loadClasses){joo.window.joo__loadClasses(fullClassName);return;}if(this[$onCompleteCallbacks].length==0){if(this[$pendingClassState][fullClassName]===undefined){this[$pendingClassState][fullClassName]=false;if(this.debug){trace("added to pending classes: "+fullClassName+".");}}}else{if(this[$pendingClassState][fullClassName]!==true){this[$pendingClassState][fullClassName]=true;var url=this.getUri(fullClassName);if(this.debug){trace("triggering to load class "+fullClassName+" from URL "+url+".");}var script=this.loadScript(url);script.onerror=this[$createClassLoadErrorHandler](fullClassName,script['src']);}}}},"protected function getBaseUri",function(){if(typeof this.urlPrefix!="string"){this.urlPrefix=this[$determineUrlPrefix]();}return this.urlPrefix;},"private function determineUrlPrefix",function(){var RUNTIME_URL_PATTERN=/^(.*)\bjangaroo-runtime[^.]*\.js$/;var scripts=joo.window.document.getElementsByTagName("SCRIPT");for(var i=0;i<scripts.length;++i){var match=RUNTIME_URL_PATTERN.exec(scripts[i].src);if(match){return match[1]+"classes/";}}if(this.debug){trace("WARNING: no joo.classLoader.urlPrefix set and Jangaroo Runtime script element not found. "+"Falling back to standard urlPrefix '"+joo.DynamicClassLoader.STANDARD_URL_PREFIX+"'.");}return joo.DynamicClassLoader.STANDARD_URL_PREFIX;},"protected function getUri",function(fullClassName){var baseUri=this.getBaseUri();return baseUri+fullClassName.replace(/\./g,"/")+".js";},"public override function complete",function(onCompleteCallback){if(onCompleteCallback||this[$onCompleteCallbacks].length==0){this[$onCompleteCallbacks].push(onCompleteCallback||$$private.defaultOnCompleteCallback);}this[$loadPendingDependencies]();if($$private.isEmpty(this[$pendingClassState])){this[$complete](onCompleteCallback);}else{for(var c in this[$pendingClassState]){this[$load](c);}}},"private static function defaultOnCompleteCallback",function(){trace("All classes loaded!");},"private function loadPendingDependencies",function(){for(var j=0;j<this[$pendingDependencies].length;++j){var dependencies=(this[$pendingDependencies][j]).getDependencies();for(var i=0;i<dependencies.length;++i){this[$load](dependencies[i]);}}this[$pendingDependencies]=[];},];},[],["joo.StandardClassLoader"]);joo.classLoader.prepare("package joo",[""],"public class ResourceBundleAwareClassLoader extends joo.DynamicClassLoader",function($$private){with($$private)return["private static const",{DAYS_TILL_LOCALE_COOKIE_EXPIRY:10*356},"private static const",{RESOURCE_BUNDLE_PATTERN:/_properties$/},"public var",{supportedLocales: undefined},"public var",{localeCookieName: undefined},"public var",{localeCookiePath:function(){return(joo.window.location.pathname);}},"public var",{localeCookieDomain:null},"public function ResourceBundleAwareClassLoader",function(supportedLocales,localeCookieName){if(arguments.length<2){if(arguments.length<1){supportedLocales=["en"];}localeCookieName="joo.locale";}var debug=joo.classLoader.debug;var urlPrefix=(joo.classLoader).urlPrefix;this[$super]();this.debug=debug;this.urlPrefix=urlPrefix;this.supportedLocales=supportedLocales;this.localeCookieName=localeCookieName;},"private static function isBundleName",function(fullClassName){return! !fullClassName.match($$private.RESOURCE_BUNDLE_PATTERN);},"private function escape",function(s){return s.replace(/([.*+?^${}()|[\]\/\\])/g,"\\$1");},"private function readLocaleFromCookie",function(){var cookieKey=this[$escape](this.localeCookieName);var match=joo.window.document.cookie.match("(?:^|;)\\s*"+cookieKey+"=([^;]*)");return match?decodeURIComponent(match[1]):null;},"private function setCookie",function(name,value,path,expires,domain,secure){if(arguments.length<6){if(arguments.length<5){if(arguments.length<4){if(arguments.length<3){path=null;}expires=null;}domain=null;}secure=false;}joo.window.document.cookie=name+"="+encodeURIComponent(value)+((expires===null)?"":("; expires="+expires.toGMTString()))+((path===null)?"":("; path="+path))+((domain===null)?"":("; domain="+domain))+(secure?"; secure":"");},"private function getLocaleCookieExpiry",function(){var date=new Date();date.setTime(date.getTime()+($$private.DAYS_TILL_LOCALE_COOKIE_EXPIRY*24*60*60*1000));return date;},"public function setLocale",function(locale){this[$setCookie](this.localeCookieName,locale,this.localeCookiePath,this[$getLocaleCookieExpiry](),this.localeCookieDomain);},"public function getLocale",function(){var userLocale=this[$readLocaleFromCookie]();if(!userLocale&&joo.window.navigator){userLocale=joo.window.navigator.language||joo.window.navigator.browserLanguage||joo.window.navigator.systemLanguage||joo.window.navigator.userLanguage;if(userLocale){userLocale=userLocale.replace(/-/g,"_");}}if(!userLocale){userLocale="en";}var longestMatch;for(var i=0;i<this.supportedLocales.length;i++){if(userLocale.indexOf(this.supportedLocales[i])===0){if(!longestMatch||longestMatch.length>this.supportedLocales[i]){longestMatch=this.supportedLocales[i];}}}return longestMatch;},"private function getCurrentLocaleSuffix",function(){var locale=this.getLocale();return!locale||locale==="en"?"":"_"+locale;},"override protected function getUri",function(fullClassName){if($$private.isBundleName(fullClassName)){fullClassName+=this[$getCurrentLocaleSuffix]();}return this[$getUri](fullClassName);},];},[],["joo.DynamicClassLoader","Date"]);joo.classLoader = new joo.DynamicClassLoader();